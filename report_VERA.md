# Практическая работа №9


## Постановка задачи

Разработать реляционную базу данных "Библиотека", предназначенную для хранения информации о книгах, читателях и их взаимодействии с изданиями (выдача книг, возврат, история чтения и пр.). Система должна поддерживать роли пользователей с разными уровнями доступа и протоколировать все действия, изменяющие данные в базе.

### Требования к базе данных:

1. **Структура базы данных:**
   - Таблицы-справочники (например, жанры, авторы, типы изданий).
   - Основные таблицы, использующие справочники (например, книги, читатели, формуляры).
   - Обеспечение ссылочной целостности (внешние ключи).

2. **Ролевой доступ:**
   - **Оператор БД** — наполнение и изменение справочников.
   - **Пользователь БД** — работа с основной функциональностью, с ограничениями по редактированию.
   - **Аналитик** — доступ только к аналитическим запросам, без возможности изменения данных.
   - **Администратор БД** — полный доступ, включая просмотр журнала операций и изменение структуры БД.

3. **Протоколирование действий:**
   - Все действия, изменяющие данные (INSERT, UPDATE, DELETE), выполняемые пользователями любых ролей, фиксируются в журнале операций.

4. **Оптимизация запросов:**
   - Для всех часто используемых запросов созданы индексы.
   - При тестировании использовалась настройка `enable_seqscan = off` для принудительного использования индексов.

5. **Интерфейс взаимодействия:**
   - Разработаны SQL-функции для работы с базой (добавление книги, выдача книги читателю, возврат книги, регистрация читателя и др.).
   - Все функции проверены как на успешные, так и на ошибочные сценарии выполнения.

6. **Аналитика:**
   - Реализована аналитическая функция, формирующая рекомендации по книгам для читателей с учетом их пола, возраста и предпочтений, основанная на статистике прочитанных изданий.

---

## Результаты работы

В процессе разработки были выполнены следующие шаги:

- Спроектирована структура базы данных с учетом нормализации данных и обеспечения целостности.
- Созданы основные справочники (авторы, жанры, издательства и др.).
- Реализованы роли пользователей и соответствующие ограничения на уровне PostgreSQL.
- Разработан журнал операций с автоматической регистрацией всех изменений.
- Созданы и протестированы SQL-функции для всех ключевых операций.
- Проведена проверка функций на граничные случаи: добавление некорректных данных, попытки нарушить ограничения доступа и целостности.
- Выполнена настройка и создание индексов для оптимизации поиска и фильтрации данных.
- Проведена разработка аналитического модуля, предоставляющего персонализированные рекомендации читателям.

---

## Выводы

Разработанная база данных "Библиотека" соответствует поставленным требованиям:

- Обеспечена надежность хранения и связность данных благодаря использованию справочников и внешних ключей.
- Реализована гибкая система ролей, позволяющая разграничить доступ к данным в соответствии с потребностями различных типов пользователей.
- Все операции, влияющие на данные, корректно протоколируются, что позволяет отследить любые изменения в базе.
- Система прошла тестирование на устойчивость к ошибкам и некорректному вводу.
- Оптимизация запросов через индексы и аналитические функции делает систему пригодной для масштабного использования.

База данных готова к эксплуатации и может быть расширена в будущем (например, с добавлением функций бронирования книг, учета штрафов, интеграции с внешними библиотечными системами и т.д.).

---



















```sql
CREATE TABLE persons (
    id SERIAL PRIMARY KEY,
    last_name TEXT,
    first_name TEXT,
    patronymic TEXT,
    description TEXT
);


```
![alt text](./img/screen-1.png)
---

## 1.  Добавить данные в таблицу (в виде строки)

```sql
INSERT INTO persons (last_name, first_name, patronymic, description)
VALUES ('Иванов', 'Иван', 'Иванович', 'Пример записи');
```
![alt text](./img/screen-2.png)

Пояснение:
```sql
INSERT INTO — добавляет новую строку в таблицу.

VALUES (...) — задаёт значения для перечисленных столбцов.
 ```
 **_______________________**

---

